{% extends "front/base.html" %}{% block content %} {% load static %}
<!-- Compass Control Positioned at the Top of the Page with N, E, S, W -->
<div class="fixed-compass">
  <div class="compass-direction north">N</div>
  <div class="compass-direction east">E</div>
  <div class="compass-direction south">S</div>
  <div class="compass-direction west">W</div>
  <div class="compass-inner" id="compass">â€¢</div> <!-- Inner circle for rotation -->
</div>

<div id="map" style="height: 600px;"></div>


<script>
  document.addEventListener("DOMContentLoaded", function () {
    const windowHeight = window.innerHeight;
    const div = document.getElementById('map');
    div.style.height = `${window.innerHeight - 100}px`;
  });

  function initMap() {
    // Coordinates for the center of the city (Gurgaon)
    var cityCenter = { lat: 28.408062, lng: 77.014452 };
    var gurgaonBounds = {
      north: 28.55476998927484,  // Northern boundary
      south: 28.371787123082136, // Southern boundary
      west: 76.94973515874823,   // Western boundary
      east: 77.13974236261555    // Eastern boundary
    };
    // Create the map, centered on the city
    var map = new google.maps.Map(document.getElementById('map'), {
      zoom: 11,             // Set the initial zoom level
      minZoom: 11,           // Minimum zoom level allowed
      maxZoom: 20,          // Maximum zoom level allowed
      center: cityCenter,
      zoomControl: true,      // Enable zoom control buttons
      //draggable: false,      // Disable map dragging (panning)
      //gestureHandling: 'none', // Disable zoom by mouse wheel or gesture
      disableDefaultUI: true,  // Dis

      // restriction: {
      //     latLngBounds: gurgaonBounds,  // Restrict to Gurgaon bounds
      //     strictBounds: true            // Prevent movement outside of bounds
      // }
      // restriction: {
      //     latLngBounds: { 
      //         north: 28.55476998927484,  // Northern boundary
      //         south: 28.371787123082136, // Southern boundary
      //         west: 76.94973515874823,   // Western boundary
      //         east: 77.13974236261555    // Eastern boundary
      //     },
      //     strictBounds: true
      // }
    });

    // Load the GeoJSON file
    map.data.loadGeoJson('static/front/gurgaon.geojson');

    // Set the style for the boundaries
    map.data.setStyle({
      strokeColor: 'blue',  // Outline color (red)
      strokeOpacity: 0.8,      // Line opacity
      strokeWeight: 2,         // Line thickness
      fillColor: 'blue',    // Fill color inside boundary
      fillOpacity: 0.35        // Fill opacity
    });

    // Add event listener to the GeoJSON data layer (if you need to handle it separately)
    map.data.addListener('click', function (event) {
      var clickedLat = event.latLng.lat();
      var clickedLng = event.latLng.lng();
      console.log("GeoJSON clicked at:", { lat: clickedLat, lng: clickedLng });
    });


    {%if zone_list %}
    {% for zone_data in zone_list %}
    

    var polygonCoords = [
      {% for boundary in zone_data.zones.all %}
        { lat: {{ boundary.latitude }}, lng: {{ boundary.longitude }} },
      {% endfor %}
    ];

    var polygon = new google.maps.Polygon({
      paths: polygonCoords,
      strokeColor: '{{ zone_data.zone_color_code }}',  // Ensure zone color is a valid code
      strokeOpacity: 0.8,
      strokeWeight: 2,
      fillColor: '{{ zone_data.zone_color_code }}',    // Ensure zone color is a valid code
      fillOpacity: 0.35,
      clickable: true  // Ensure the polygon is clickable
    });
    // Display the polygon on the map
    polygon.setMap(map);

    // Calculate the center of the polygon
    function getPolygonCenter(coords) {
      var latSum = 0;
      var lngSum = 0;
      coords.forEach(function(coord) {
        latSum += coord.lat;
        lngSum += coord.lng;
      });
      return {
        lat: latSum / coords.length,
        lng: lngSum / coords.length
      };
    }

    var polygonCenter = getPolygonCenter(polygonCoords);

    // Create a marker at the center with the zone name
    var centerMarker = new google.maps.Marker({
      position: polygonCenter,
      map: map,
      title: '{{ zone_data.zone_name }}',  // This displays the zone name on hover
      icon: {
        path: google.maps.SymbolPath.CIRCLE,
        scale: 8,  // Size of the marker icon
        fillColor: '{{ zone_data.zone_color_code }}',
        fillOpacity: 1,
        strokeColor: 'white',
        strokeWeight: 2
      }
    });

     // Custom HTML for the Info Window content
     var infoContent = `
      <div class="custom-info-window">
        <h3>{{ zone_data.zone_name }}</h3>
        <p>This zone is designated with color code {{ zone_data.zone_color_code }}.</p>
         <div class="video-container">
          <iframe width="200" height="113" src="https://www.youtube.com/embed/SvgDzaIoBxY?autoplay=1&mute=1" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
        </div>
        <button onclick="alert('More info for {{ zone_data.zone_name }}')">More Info</button>
      </div>
    `;

    var centerInfoWindow = new google.maps.InfoWindow({
      content: infoContent
    });

    centerMarker.addListener('click', function() {
      centerInfoWindow.open(map, centerMarker);
    });

    var additionalMarkers = [
      { lat: 28.434320575598562, lng: 77.01516097882633, label: "Hero MotoCorp" },
      { lat: 28.404438694364607, lng: 77.00272179892329, label: "American Express" },
      { lat: 28.40200420181406, lng: 76.98938981407711, label: "Haldiram's - Kherki Daula" },
      { lat: 28.405784110959946, lng: 77.04144714320837, label: "Park View City 1" }
    ];

    // Add each additional marker with a click event
    additionalMarkers.forEach(function(markerData) {
      var additionalMarker = new google.maps.Marker({
        position: { lat: markerData.lat, lng: markerData.lng },
        map: map,
        title: '{{ zone_data.zone_name }} - ' + markerData.label,

        //label: markerData.label,
        // icon: {
        //   path: google.maps.SymbolPath.CIRCLE,
        //   scale: 5,
        //   fillColor: 'blue',
        //   fillOpacity: 1,
        //   strokeColor: 'white',
        //   strokeWeight: 1
        // }
      });

      
      


      var infoContentAdm = `
      <div class="custom-info-window">
        <h3>${markerData.label}</h3>
        <p>This zone is designated with color code {{ zone.zone_color_code }}.</p>
        <div><strong>{{ zone_data.zone_name }}</strong><br>Marker ${markerData.label}</div>
         
        
      </div>
    `;

    var centerInfoWindowAdm = new google.maps.InfoWindow({
      content: infoContentAdm
    });

    additionalMarker.addListener('click', function() {
      centerInfoWindowAdm.open(map, additionalMarker);
    });



    // Define the coordinates for the path
    var pathCoordinates = [
      { lat: 28.401267223309986, lng: 77.04323387864554 }, // Start point
      { lat: 28.400663222070822, lng: 77.030530936751 }, // Midpoint
      { lat: 28.400663222070822, lng: 77.01645470384085 }  // End point
    ];

    // Create the polyline and add it to the map
    var pathPolyline = new google.maps.Polyline({
      path: pathCoordinates,
      geodesic: true,
      strokeColor: '#FF0000',    // Line color (red)
      strokeOpacity: 1.0,        // Line opacity
      strokeWeight: 3            // Line thickness
    });

    // Display the polyline on the map
    pathPolyline.setMap(map);

      // Optional: add markers at each point of the path
    // pathCoordinates.forEach((location, index) => {
    //   new google.maps.Marker({
    //     position: location,
    //     map: map,
    //     title: `Point ${index + 1}`
    //   });
    // });

    });
   

    // Optional: Add click event to the polygon to show more info
    polygon.addListener('click', function(event) {
      alert("Zone: {{ zone_data.zone_name }} clicked!");
    });



    {% endfor %}
    {% endif %}



    // Optional: Add event listeners, e.g., for clicks or hovers
    map.data.addListener('click', function (event) {

    });
  }
</script>


{% endblock %}