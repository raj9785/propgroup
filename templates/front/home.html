{% extends "front/base.html" %}{% block content %} {% load static %}
<!-- Compass Control Positioned at the Top of the Page with N, E, S, W -->
<div class="fixed-compass">
  <div class="compass-direction north">N</div>
  <div class="compass-direction east">E</div>
  <div class="compass-direction south">S</div>
  <div class="compass-direction west">W</div>
  <div class="compass-inner" id="compass">â€¢</div> <!-- Inner circle for rotation -->
</div>

<div id="map" style="height: 600px; position: relative;"></div>
<div id="customInfoWindow" class="custom-info-window_info" style="display: none;">
  <h3>Information</h3>
  <p id="video_title"></p>
  <div class="video-container" id="video_container"></div>
  <div class="other-info" id="video_info"></div>
</div>


<script>
  document.addEventListener("DOMContentLoaded", function () {
    const windowHeight = window.innerHeight;
    const div = document.getElementById('map');
    div.style.height = `${window.innerHeight - 100}px`;
  });

  function initMap() {
    // Coordinates for the center of the city (Gurgaon)
    var cityCenter = { lat: 28.408062, lng: 77.014452 };
    var gurgaonBounds = {
      north: 28.55476998927484,  // Northern boundary
      south: 28.371787123082136, // Southern boundary
      west: 76.94973515874823,   // Western boundary
      east: 77.13974236261555    // Eastern boundary
    };
    // Create the map, centered on the city
    var map = new google.maps.Map(document.getElementById('map'), {
      zoom: 11,             // Set the initial zoom level
      minZoom: 11,           // Minimum zoom level allowed
      maxZoom: 20,          // Maximum zoom level allowed
      center: cityCenter,
      zoomControl: true,      // Enable zoom control buttons
      //draggable: false,      // Disable map dragging (panning)
      //gestureHandling: 'none', // Disable zoom by mouse wheel or gesture
      disableDefaultUI: true,  // Dis

      // restriction: {
      //     latLngBounds: gurgaonBounds,  // Restrict to Gurgaon bounds
      //     strictBounds: true            // Prevent movement outside of bounds
      // }
      // restriction: {
      //     latLngBounds: { 
      //         north: 28.55476998927484,  // Northern boundary
      //         south: 28.371787123082136, // Southern boundary
      //         west: 76.94973515874823,   // Western boundary
      //         east: 77.13974236261555    // Eastern boundary
      //     },
      //     strictBounds: true
      // }
    });

    // Load the GeoJSON file
    map.data.loadGeoJson('static/front/gurgaon.geojson');

    // Set the style for the boundaries
    map.data.setStyle({
      strokeColor: 'blue',  // Outline color (red)
      strokeOpacity: 0.8,      // Line opacity
      strokeWeight: 2,         // Line thickness
      fillColor: 'blue',    // Fill color inside boundary
      fillOpacity: 0.35        // Fill opacity
    });

    // Add event listener to the GeoJSON data layer (if you need to handle it separately)
    map.data.addListener('click', function (event) {
      var clickedLat = event.latLng.lat();
      var clickedLng = event.latLng.lng();
      console.log("GeoJSON clicked at:", { lat: clickedLat, lng: clickedLng });
      document.getElementById("customInfoWindow").style.display = "none";
    });

    var polygonsData = {{ zones_with_boundaries| safe}}

  // Loop through each polygon data and create a polygon
  polygonsData.forEach((polygonData, index) => {
    var fillOpacity = polygonData.color ? 0.35 : 0;

    var polygon = new google.maps.Polygon({
      paths: polygonData.coords,
      strokeColor: polygonData.color,
      strokeOpacity: 0.8,
      strokeWeight: 2,
      fillColor: polygonData.color,
      fillOpacity: fillOpacity,
      clickable: true
    });


    // Display the polygon on the map
    polygon.setMap(map);

    // Add a click event to each polygon
    google.maps.event.addListener(polygon, 'click', function (event) {
      // Open an InfoWindow or perform any other action here
      var infoWindow = new google.maps.InfoWindow({
        content: `<h3>${polygonData.info}</h3>`,
        position: event.latLng
      });
      infoWindow.open(map);
    });
  });


  // {%if zone_list %}
  //       {% for zone_data in zone_list %}


  var additionalMarkers = {{ markers| safe }};

  // Add each additional marker with a click event
  additionalMarkers.forEach(function (markerData) {
    var additionalMarker = new google.maps.Marker({
      position: { lat: markerData.lat, lng: markerData.lng },
      map: map,
      title: markerData.label,

      //label: markerData.label,
      icon: {
        url: markerData.icon, // URL to the custom icon image
        scaledSize: new google.maps.Size(25, 25), // Scale the icon to desired size
        origin: new google.maps.Point(0, 0), // Origin point of the icon
        anchor: new google.maps.Point(15, 15) // Anchor point of the icon (centered)
      }
    });

    var infoContentAdm = `
      <div class="custom-info-window">
        <h3>${markerData.label}</h3>
        <p>${markerData.description}</p>
        <div><strong>{{ zone_data.zone_name }}</strong><br>Marker ${markerData.label}</div>
      </div>
    `;

    var centerInfoWindowAdm = new google.maps.InfoWindow({
      content: infoContentAdm
    });

    additionalMarker.addListener('click', function () {
      centerInfoWindowAdm.open(map, additionalMarker);
    });

  });

  var paths = {{ drone_video_paths| safe }}

  // Loop through each path in the array
  paths.forEach((pathData, index) => {
    var pathPolyline = new google.maps.Polyline({
      path: pathData.coordinates,
      strokeColor: pathData.color,
      strokeOpacity: 0,
      strokeWeight: 5,
      icons: [
        {
          icon: {
            path: google.maps.SymbolPath.CIRCLE,
            scale: 4,
            fillColor: pathData.color,
            fillOpacity: 1,
            strokeWeight: 0,
          },
          offset: "0",
          repeat: "10px",
        },
      ],
      zIndex: 2099,
    });

    // Display the polyline on the map
    pathPolyline.setMap(map);

    // Add mouseover event for each polyline
    google.maps.event.addListener(pathPolyline, 'mouseover', function (event) {
      // Display custom information in the info window or another HTML element
      document.getElementById("customInfoWindow").style.display = "block";
      //document.getElementById("customInfoWindow").innerText = pathData.info;
      document.getElementById("video_container").innerHTML = pathData.html_data;
      document.getElementById("video_info").innerHTML = pathData.info;
      document.getElementById("video_title").innerHTML = pathData.title;
    });
    
    // Add mouseout event to hide the info window when the mouse leaves the polyline
    google.maps.event.addListener(pathPolyline, 'mouseout', function () {
      document.getElementById("customInfoWindow").style.display = "none";
    });
  });
 
  // Optional: Add click event to the polygon to show more info
  // polygon.addListener('click', function (event) {
  //   alert("Zone: {{ zone_data.zone_name }} clicked!");
  // });

  // {% endfor %}
  // {% endif %}



    // Optional: Add event listeners, e.g., for clicks or hovers
    // map.data.addListener('click', function (event) {
    //   document.getElementById("customInfoWindow").style.display = "none";
    // });
  }

  function openInfoWindow(id, type) {
    document.getElementById("customInfoWindow").style.display = "block";
  }
</script>



{% endblock %}